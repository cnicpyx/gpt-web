"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/page",{

/***/ "(app-client)/./app/client/platforms/openai.ts":
/*!****************************************!*\
  !*** ./app/client/platforms/openai.ts ***!
  \****************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ChatGPTApi: function() { return /* binding */ ChatGPTApi; },\n/* harmony export */   OpenaiPath: function() { return /* reexport safe */ _app_constant__WEBPACK_IMPORTED_MODULE_0__.OpenaiPath; }\n/* harmony export */ });\n/* harmony import */ var _app_constant__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/app/constant */ \"(app-client)/./app/constant.ts\");\n/* harmony import */ var _app_store__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/app/store */ \"(app-client)/./app/store/index.ts\");\n/* harmony import */ var _api__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../api */ \"(app-client)/./app/client/api.ts\");\n/* harmony import */ var _locales__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../locales */ \"(app-client)/./app/locales/index.ts\");\n/* harmony import */ var _fortaine_fetch_event_source__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @fortaine/fetch-event-source */ \"(app-client)/./node_modules/@fortaine/fetch-event-source/lib/esm/fetch.js\");\n/* harmony import */ var _app_utils_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/app/utils/format */ \"(app-client)/./app/utils/format.ts\");\n/* harmony import */ var _app_config_client__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/app/config/client */ \"(app-client)/./app/config/client.ts\");\n/* harmony import */ var _app_azure__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/app/azure */ \"(app-client)/./app/azure.ts\");\n/* __next_internal_client_entry_do_not_use__ ChatGPTApi,OpenaiPath auto */ \n\n\n\n\n\n\n\nclass ChatGPTApi {\n    path(path) {\n        const accessStore = _app_store__WEBPACK_IMPORTED_MODULE_1__.useAccessStore.getState();\n        const isAzure = accessStore.provider === _app_constant__WEBPACK_IMPORTED_MODULE_0__.ServiceProvider.Azure;\n        if (isAzure && !accessStore.isValidAzure()) {\n            throw Error(\"incomplete azure config, please check it in your settings page\");\n        }\n        let baseUrl = isAzure ? accessStore.azureUrl : accessStore.openaiUrl;\n        if (baseUrl.length === 0) {\n            var _getClientConfig;\n            const isApp = !!((_getClientConfig = (0,_app_config_client__WEBPACK_IMPORTED_MODULE_5__.getClientConfig)()) === null || _getClientConfig === void 0 ? void 0 : _getClientConfig.isApp);\n            baseUrl = isApp ? _app_constant__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_API_HOST + \"/proxy\" + _app_constant__WEBPACK_IMPORTED_MODULE_0__.ApiPath.OpenAI : _app_constant__WEBPACK_IMPORTED_MODULE_0__.ApiPath.OpenAI;\n        }\n        if (baseUrl.endsWith(\"/\")) {\n            baseUrl = baseUrl.slice(0, baseUrl.length - 1);\n        }\n        if (!baseUrl.startsWith(\"http\") && !baseUrl.startsWith(_app_constant__WEBPACK_IMPORTED_MODULE_0__.ApiPath.OpenAI)) {\n            baseUrl = \"https://\" + baseUrl;\n        }\n        if (isAzure) {\n            path = (0,_app_azure__WEBPACK_IMPORTED_MODULE_6__.makeAzurePath)(path, accessStore.azureApiVersion);\n        }\n        console.log(\"[Proxy Endpoint] \", baseUrl, path);\n        return [\n            baseUrl,\n            path\n        ].join(\"/\");\n    }\n    extractMessage(res) {\n        var _res_choices_at_message, _res_choices_at, _res_choices;\n        var _res_choices_at_message_content;\n        return (_res_choices_at_message_content = (_res_choices = res.choices) === null || _res_choices === void 0 ? void 0 : (_res_choices_at = _res_choices.at(0)) === null || _res_choices_at === void 0 ? void 0 : (_res_choices_at_message = _res_choices_at.message) === null || _res_choices_at_message === void 0 ? void 0 : _res_choices_at_message.content) !== null && _res_choices_at_message_content !== void 0 ? _res_choices_at_message_content : \"\";\n    }\n    async chat(options) {\n        var _options_onController, _options;\n        const messages = options.messages.map((v)=>({\n                role: v.role,\n                content: v.content\n            }));\n        const modelConfig = {\n            ..._app_store__WEBPACK_IMPORTED_MODULE_1__.useAppConfig.getState().modelConfig,\n            ..._app_store__WEBPACK_IMPORTED_MODULE_1__.useChatStore.getState().currentSession().mask.modelConfig,\n            ...{\n                model: options.config.model\n            }\n        };\n        const requestPayload = {\n            messages,\n            stream: options.config.stream,\n            model: modelConfig.model,\n            temperature: modelConfig.temperature,\n            presence_penalty: modelConfig.presence_penalty,\n            frequency_penalty: modelConfig.frequency_penalty,\n            top_p: modelConfig.top_p\n        };\n        console.log(\"[Request] openai payload: \", requestPayload);\n        const shouldStream = !!options.config.stream;\n        const controller = new AbortController();\n        (_options_onController = (_options = options).onController) === null || _options_onController === void 0 ? void 0 : _options_onController.call(_options, controller);\n        try {\n            const chatPath = this.path(_app_constant__WEBPACK_IMPORTED_MODULE_0__.OpenaiPath.ChatPath);\n            const chatPayload = {\n                method: \"POST\",\n                body: JSON.stringify(requestPayload),\n                signal: controller.signal,\n                headers: (0,_api__WEBPACK_IMPORTED_MODULE_2__.getHeaders)()\n            };\n            // make a fetch request\n            const requestTimeoutId = setTimeout(()=>controller.abort(), _app_constant__WEBPACK_IMPORTED_MODULE_0__.REQUEST_TIMEOUT_MS);\n            if (shouldStream) {\n                let responseText = \"\";\n                let remainText = \"\";\n                let finished = false;\n                // animate response to make it looks smooth\n                function animateResponseText() {\n                    if (finished || controller.signal.aborted) {\n                        responseText += remainText;\n                        console.log(\"[Response Animation] finished\");\n                        return;\n                    }\n                    if (remainText.length > 0) {\n                        var _options_onUpdate, _options;\n                        const fetchCount = Math.max(1, Math.round(remainText.length / 60));\n                        const fetchText = remainText.slice(0, fetchCount);\n                        responseText += fetchText;\n                        remainText = remainText.slice(fetchCount);\n                        (_options_onUpdate = (_options = options).onUpdate) === null || _options_onUpdate === void 0 ? void 0 : _options_onUpdate.call(_options, responseText, fetchText);\n                    }\n                    requestAnimationFrame(animateResponseText);\n                }\n                // start animaion\n                animateResponseText();\n                const finish = ()=>{\n                    if (!finished) {\n                        finished = true;\n                        options.onFinish(responseText + remainText);\n                    }\n                };\n                controller.signal.onabort = finish;\n                (0,_fortaine_fetch_event_source__WEBPACK_IMPORTED_MODULE_7__.fetchEventSource)(chatPath, {\n                    ...chatPayload,\n                    async onopen (res) {\n                        var _contentType, _res_headers_get;\n                        clearTimeout(requestTimeoutId);\n                        const contentType = res.headers.get(\"content-type\");\n                        console.log(\"[OpenAI] request response content type: \", contentType);\n                        if ((_contentType = contentType) === null || _contentType === void 0 ? void 0 : _contentType.startsWith(\"text/plain\")) {\n                            responseText = await res.clone().text();\n                            return finish();\n                        }\n                        if (!res.ok || !((_res_headers_get = res.headers.get(\"content-type\")) === null || _res_headers_get === void 0 ? void 0 : _res_headers_get.startsWith(_fortaine_fetch_event_source__WEBPACK_IMPORTED_MODULE_7__.EventStreamContentType)) || res.status !== 200) {\n                            const responseTexts = [\n                                responseText\n                            ];\n                            let extraInfo = await res.clone().text();\n                            try {\n                                const resJson = await res.clone().json();\n                                extraInfo = (0,_app_utils_format__WEBPACK_IMPORTED_MODULE_4__.prettyObject)(resJson);\n                            } catch (e) {}\n                            if (res.status === 401) {\n                                responseTexts.push(_locales__WEBPACK_IMPORTED_MODULE_3__[\"default\"].Error.Unauthorized);\n                                location.href = \"/#/auth\";\n                            }\n                            if (extraInfo) {\n                                responseTexts.push(extraInfo);\n                            }\n                            responseText = responseTexts.join(\"\\n\\n\");\n                            return finish();\n                        }\n                    },\n                    onmessage (msg) {\n                        if (msg.data === \"[DONE]\" || finished) {\n                            return finish();\n                        }\n                        const text = msg.data;\n                        try {\n                            var _json_choices__delta, _json_choices_;\n                            const json = JSON.parse(text);\n                            const delta = (_json_choices_ = json.choices[0]) === null || _json_choices_ === void 0 ? void 0 : (_json_choices__delta = _json_choices_.delta) === null || _json_choices__delta === void 0 ? void 0 : _json_choices__delta.content;\n                            if (delta) {\n                                remainText += delta;\n                            }\n                        } catch (e) {\n                            console.error(\"[Request] parse error\", text);\n                        }\n                    },\n                    onclose () {\n                        finish();\n                    },\n                    onerror (e) {\n                        var _options_onError, _options;\n                        (_options_onError = (_options = options).onError) === null || _options_onError === void 0 ? void 0 : _options_onError.call(_options, e);\n                        throw e;\n                    },\n                    openWhenHidden: true\n                });\n            } else {\n                const res = await fetch(chatPath, chatPayload);\n                clearTimeout(requestTimeoutId);\n                const resJson = await res.json();\n                const message = this.extractMessage(resJson);\n                options.onFinish(message);\n            }\n        } catch (e) {\n            var _options_onError, _options1;\n            console.log(\"[Request] failed to make a chat request\", e);\n            (_options_onError = (_options1 = options).onError) === null || _options_onError === void 0 ? void 0 : _options_onError.call(_options1, e);\n        }\n    }\n    async usage() {\n        const formatDate = (d)=>\"\".concat(d.getFullYear(), \"-\").concat((d.getMonth() + 1).toString().padStart(2, \"0\"), \"-\").concat(d.getDate().toString().padStart(2, \"0\"));\n        const ONE_DAY = 1 * 24 * 60 * 60 * 1000;\n        const now = new Date();\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n        const startDate = formatDate(startOfMonth);\n        const endDate = formatDate(new Date(Date.now() + ONE_DAY));\n        const [used, subs] = await Promise.all([\n            fetch(this.path(\"\".concat(_app_constant__WEBPACK_IMPORTED_MODULE_0__.OpenaiPath.UsagePath, \"?start_date=\").concat(startDate, \"&end_date=\").concat(endDate)), {\n                method: \"GET\",\n                headers: (0,_api__WEBPACK_IMPORTED_MODULE_2__.getHeaders)()\n            }),\n            fetch(this.path(_app_constant__WEBPACK_IMPORTED_MODULE_0__.OpenaiPath.SubsPath), {\n                method: \"GET\",\n                headers: (0,_api__WEBPACK_IMPORTED_MODULE_2__.getHeaders)()\n            })\n        ]);\n        if (used.status === 401) {\n            throw new Error(_locales__WEBPACK_IMPORTED_MODULE_3__[\"default\"].Error.Unauthorized);\n        }\n        if (!used.ok || !subs.ok) {\n            throw new Error(\"Failed to query usage from openai\");\n        }\n        const response = await used.json();\n        const total = await subs.json();\n        if (response.error && response.error.type) {\n            throw Error(response.error.message);\n        }\n        if (response.total_usage) {\n            response.total_usage = Math.round(response.total_usage) / 100;\n        }\n        if (total.hard_limit_usd) {\n            total.hard_limit_usd = Math.round(total.hard_limit_usd * 100) / 100;\n        }\n        return {\n            used: response.total_usage,\n            total: total.hard_limit_usd\n        };\n    }\n    async models() {\n        var _resJson_data;\n        if (this.disableListModels) {\n            return _app_constant__WEBPACK_IMPORTED_MODULE_0__.DEFAULT_MODELS.slice();\n        }\n        const res = await fetch(this.path(_app_constant__WEBPACK_IMPORTED_MODULE_0__.OpenaiPath.ListModelPath), {\n            method: \"GET\",\n            headers: {\n                ...(0,_api__WEBPACK_IMPORTED_MODULE_2__.getHeaders)()\n            }\n        });\n        const resJson = await res.json();\n        const chatModels = (_resJson_data = resJson.data) === null || _resJson_data === void 0 ? void 0 : _resJson_data.filter((m)=>m.id.startsWith(\"gpt-\"));\n        console.log(\"[Models]\", chatModels);\n        if (!chatModels) {\n            return [];\n        }\n        return chatModels.map((m)=>({\n                name: m.id,\n                available: true,\n                provider: {\n                    id: \"openai\",\n                    providerName: \"OpenAI\",\n                    providerType: \"openai\"\n                }\n            }));\n    }\n    constructor(){\n        this.disableListModels = true;\n    }\n}\n\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevExports = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevExports) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports on update so we can compare the boundary\n                // signatures.\n                module.hot.dispose(function (data) {\n                    data.prevExports = currentExports;\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevExports !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevExports, currentExports)) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevExports !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1jbGllbnQpLy4vYXBwL2NsaWVudC9wbGF0Zm9ybXMvb3BlbmFpLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7MkVBUXdCO0FBQ2lEO0FBRUk7QUFDMUM7QUFJRztBQUNZO0FBQ0k7QUFDVjtBQVdyQyxNQUFNZ0I7SUFHWEMsS0FBS0EsSUFBWSxFQUFVO1FBQ3pCLE1BQU1DLGNBQWNaLHNEQUFjQSxDQUFDYSxRQUFRO1FBRTNDLE1BQU1DLFVBQVVGLFlBQVlHLFFBQVEsS0FBS2hCLDBEQUFlQSxDQUFDaUIsS0FBSztRQUU5RCxJQUFJRixXQUFXLENBQUNGLFlBQVlLLFlBQVksSUFBSTtZQUMxQyxNQUFNQyxNQUNKO1FBRUo7UUFFQSxJQUFJQyxVQUFVTCxVQUFVRixZQUFZUSxRQUFRLEdBQUdSLFlBQVlTLFNBQVM7UUFFcEUsSUFBSUYsUUFBUUcsTUFBTSxLQUFLLEdBQUc7Z0JBQ1JkO1lBQWhCLE1BQU1lLFFBQVEsQ0FBQyxHQUFDZixtQkFBQUEsbUVBQWVBLGdCQUFmQSx1Q0FBQUEsaUJBQW1CZSxLQUFLO1lBQ3hDSixVQUFVSSxRQUNONUIsMkRBQWdCQSxHQUFHLFdBQVdELGtEQUFPQSxDQUFDOEIsTUFBTSxHQUM1QzlCLGtEQUFPQSxDQUFDOEIsTUFBTTtRQUNwQjtRQUVBLElBQUlMLFFBQVFNLFFBQVEsQ0FBQyxNQUFNO1lBQ3pCTixVQUFVQSxRQUFRTyxLQUFLLENBQUMsR0FBR1AsUUFBUUcsTUFBTSxHQUFHO1FBQzlDO1FBQ0EsSUFBSSxDQUFDSCxRQUFRUSxVQUFVLENBQUMsV0FBVyxDQUFDUixRQUFRUSxVQUFVLENBQUNqQyxrREFBT0EsQ0FBQzhCLE1BQU0sR0FBRztZQUN0RUwsVUFBVSxhQUFhQTtRQUN6QjtRQUVBLElBQUlMLFNBQVM7WUFDWEgsT0FBT0YseURBQWFBLENBQUNFLE1BQU1DLFlBQVlnQixlQUFlO1FBQ3hEO1FBRUFDLFFBQVFDLEdBQUcsQ0FBQyxxQkFBcUJYLFNBQVNSO1FBRTFDLE9BQU87WUFBQ1E7WUFBU1I7U0FB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QUFFO1FBQ1g7UUFFQSxPQUFPQSxXQUFXckcsR0FBRyxDQUFDLENBQUN1RyxJQUFPO2dCQUM1QkUsTUFBTUYsRUFBRUMsRUFBRTtnQkFDVkUsV0FBVztnQkFDWHBJLFVBQVU7b0JBQ1JrSSxJQUFJO29CQUNKRyxjQUFjO29CQUNkQyxjQUFjO2dCQUNoQjtZQUNGO0lBQ0Y7O2FBbFRRVCxvQkFBb0I7O0FBbVQ5QjtBQUNzQiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9hcHAvY2xpZW50L3BsYXRmb3Jtcy9vcGVuYWkudHM/YWRmYSJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBjbGllbnRcIjtcbmltcG9ydCB7XG4gIEFwaVBhdGgsXG4gIERFRkFVTFRfQVBJX0hPU1QsXG4gIERFRkFVTFRfTU9ERUxTLFxuICBPcGVuYWlQYXRoLFxuICBSRVFVRVNUX1RJTUVPVVRfTVMsXG4gIFNlcnZpY2VQcm92aWRlcixcbn0gZnJvbSBcIkAvYXBwL2NvbnN0YW50XCI7XG5pbXBvcnQgeyB1c2VBY2Nlc3NTdG9yZSwgdXNlQXBwQ29uZmlnLCB1c2VDaGF0U3RvcmUgfSBmcm9tIFwiQC9hcHAvc3RvcmVcIjtcblxuaW1wb3J0IHsgQ2hhdE9wdGlvbnMsIGdldEhlYWRlcnMsIExMTUFwaSwgTExNTW9kZWwsIExMTVVzYWdlIH0gZnJvbSBcIi4uL2FwaVwiO1xuaW1wb3J0IExvY2FsZSBmcm9tIFwiLi4vLi4vbG9jYWxlc1wiO1xuaW1wb3J0IHtcbiAgRXZlbnRTdHJlYW1Db250ZW50VHlwZSxcbiAgZmV0Y2hFdmVudFNvdXJjZSxcbn0gZnJvbSBcIkBmb3J0YWluZS9mZXRjaC1ldmVudC1zb3VyY2VcIjtcbmltcG9ydCB7IHByZXR0eU9iamVjdCB9IGZyb20gXCJAL2FwcC91dGlscy9mb3JtYXRcIjtcbmltcG9ydCB7IGdldENsaWVudENvbmZpZyB9IGZyb20gXCJAL2FwcC9jb25maWcvY2xpZW50XCI7XG5pbXBvcnQgeyBtYWtlQXp1cmVQYXRoIH0gZnJvbSBcIkAvYXBwL2F6dXJlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3BlbkFJTGlzdE1vZGVsUmVzcG9uc2Uge1xuICBvYmplY3Q6IHN0cmluZztcbiAgZGF0YTogQXJyYXk8e1xuICAgIGlkOiBzdHJpbmc7XG4gICAgb2JqZWN0OiBzdHJpbmc7XG4gICAgcm9vdDogc3RyaW5nO1xuICB9Pjtcbn1cblxuZXhwb3J0IGNsYXNzIENoYXRHUFRBcGkgaW1wbGVtZW50cyBMTE1BcGkge1xuICBwcml2YXRlIGRpc2FibGVMaXN0TW9kZWxzID0gdHJ1ZTtcblxuICBwYXRoKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgYWNjZXNzU3RvcmUgPSB1c2VBY2Nlc3NTdG9yZS5nZXRTdGF0ZSgpO1xuXG4gICAgY29uc3QgaXNBenVyZSA9IGFjY2Vzc1N0b3JlLnByb3ZpZGVyID09PSBTZXJ2aWNlUHJvdmlkZXIuQXp1cmU7XG5cbiAgICBpZiAoaXNBenVyZSAmJiAhYWNjZXNzU3RvcmUuaXNWYWxpZEF6dXJlKCkpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBcImluY29tcGxldGUgYXp1cmUgY29uZmlnLCBwbGVhc2UgY2hlY2sgaXQgaW4geW91ciBzZXR0aW5ncyBwYWdlXCIsXG4gICAgICApO1xuICAgIH1cblxuICAgIGxldCBiYXNlVXJsID0gaXNBenVyZSA/IGFjY2Vzc1N0b3JlLmF6dXJlVXJsIDogYWNjZXNzU3RvcmUub3BlbmFpVXJsO1xuXG4gICAgaWYgKGJhc2VVcmwubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBpc0FwcCA9ICEhZ2V0Q2xpZW50Q29uZmlnKCk/LmlzQXBwO1xuICAgICAgYmFzZVVybCA9IGlzQXBwXG4gICAgICAgID8gREVGQVVMVF9BUElfSE9TVCArIFwiL3Byb3h5XCIgKyBBcGlQYXRoLk9wZW5BSVxuICAgICAgICA6IEFwaVBhdGguT3BlbkFJO1xuICAgIH1cblxuICAgIGlmIChiYXNlVXJsLmVuZHNXaXRoKFwiL1wiKSkge1xuICAgICAgYmFzZVVybCA9IGJhc2VVcmwuc2xpY2UoMCwgYmFzZVVybC5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgaWYgKCFiYXNlVXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpICYmICFiYXNlVXJsLnN0YXJ0c1dpdGgoQXBpUGF0aC5PcGVuQUkpKSB7XG4gICAgICBiYXNlVXJsID0gXCJodHRwczovL1wiICsgYmFzZVVybDtcbiAgICB9XG5cbiAgICBpZiAoaXNBenVyZSkge1xuICAgICAgcGF0aCA9IG1ha2VBenVyZVBhdGgocGF0aCwgYWNjZXNzU3RvcmUuYXp1cmVBcGlWZXJzaW9uKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcIltQcm94eSBFbmRwb2ludF0gXCIsIGJhc2VVcmwsIHBhdGgpO1xuXG4gICAgcmV0dXJuIFtiYXNlVXJsLCBwYXRoXS5qb2luKFwiL1wiKTtcbiAgfVxuXG4gIGV4dHJhY3RNZXNzYWdlKHJlczogYW55KSB7XG4gICAgcmV0dXJuIHJlcy5jaG9pY2VzPy5hdCgwKT8ubWVzc2FnZT8uY29udGVudCA/PyBcIlwiO1xuICB9XG5cbiAgYXN5bmMgY2hhdChvcHRpb25zOiBDaGF0T3B0aW9ucykge1xuICAgIGNvbnN0IG1lc3NhZ2VzID0gb3B0aW9ucy5tZXNzYWdlcy5tYXAoKHYpID0+ICh7XG4gICAgICByb2xlOiB2LnJvbGUsXG4gICAgICBjb250ZW50OiB2LmNvbnRlbnQsXG4gICAgfSkpO1xuXG4gICAgY29uc3QgbW9kZWxDb25maWcgPSB7XG4gICAgICAuLi51c2VBcHBDb25maWcuZ2V0U3RhdGUoKS5tb2RlbENvbmZpZyxcbiAgICAgIC4uLnVzZUNoYXRTdG9yZS5nZXRTdGF0ZSgpLmN1cnJlbnRTZXNzaW9uKCkubWFzay5tb2RlbENvbmZpZyxcbiAgICAgIC4uLntcbiAgICAgICAgbW9kZWw6IG9wdGlvbnMuY29uZmlnLm1vZGVsLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgcmVxdWVzdFBheWxvYWQgPSB7XG4gICAgICBtZXNzYWdlcyxcbiAgICAgIHN0cmVhbTogb3B0aW9ucy5jb25maWcuc3RyZWFtLFxuICAgICAgbW9kZWw6IG1vZGVsQ29uZmlnLm1vZGVsLFxuICAgICAgdGVtcGVyYXR1cmU6IG1vZGVsQ29uZmlnLnRlbXBlcmF0dXJlLFxuICAgICAgcHJlc2VuY2VfcGVuYWx0eTogbW9kZWxDb25maWcucHJlc2VuY2VfcGVuYWx0eSxcbiAgICAgIGZyZXF1ZW5jeV9wZW5hbHR5OiBtb2RlbENvbmZpZy5mcmVxdWVuY3lfcGVuYWx0eSxcbiAgICAgIHRvcF9wOiBtb2RlbENvbmZpZy50b3BfcCxcbiAgICAgIC8vIG1heF90b2tlbnM6IE1hdGgubWF4KG1vZGVsQ29uZmlnLm1heF90b2tlbnMsIDEwMjQpLFxuICAgICAgLy8gUGxlYXNlIGRvIG5vdCBhc2sgbWUgd2h5IG5vdCBzZW5kIG1heF90b2tlbnMsIG5vIHJlYXNvbiwgdGhpcyBwYXJhbSBpcyBqdXN0IHNoaXQsIEkgZG9udCB3YW50IHRvIGV4cGxhaW4gYW55bW9yZS5cbiAgICB9O1xuXG4gICAgY29uc29sZS5sb2coXCJbUmVxdWVzdF0gb3BlbmFpIHBheWxvYWQ6IFwiLCByZXF1ZXN0UGF5bG9hZCk7XG5cbiAgICBjb25zdCBzaG91bGRTdHJlYW0gPSAhIW9wdGlvbnMuY29uZmlnLnN0cmVhbTtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIG9wdGlvbnMub25Db250cm9sbGVyPy4oY29udHJvbGxlcik7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2hhdFBhdGggPSB0aGlzLnBhdGgoT3BlbmFpUGF0aC5DaGF0UGF0aCk7XG4gICAgICBjb25zdCBjaGF0UGF5bG9hZCA9IHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdFBheWxvYWQpLFxuICAgICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsLFxuICAgICAgICBoZWFkZXJzOiBnZXRIZWFkZXJzKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBtYWtlIGEgZmV0Y2ggcmVxdWVzdFxuICAgICAgY29uc3QgcmVxdWVzdFRpbWVvdXRJZCA9IHNldFRpbWVvdXQoXG4gICAgICAgICgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSxcbiAgICAgICAgUkVRVUVTVF9USU1FT1VUX01TLFxuICAgICAgKTtcblxuICAgICAgaWYgKHNob3VsZFN0cmVhbSkge1xuICAgICAgICBsZXQgcmVzcG9uc2VUZXh0ID0gXCJcIjtcbiAgICAgICAgbGV0IHJlbWFpblRleHQgPSBcIlwiO1xuICAgICAgICBsZXQgZmluaXNoZWQgPSBmYWxzZTtcblxuICAgICAgICAvLyBhbmltYXRlIHJlc3BvbnNlIHRvIG1ha2UgaXQgbG9va3Mgc21vb3RoXG4gICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVSZXNwb25zZVRleHQoKSB7XG4gICAgICAgICAgaWYgKGZpbmlzaGVkIHx8IGNvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlVGV4dCArPSByZW1haW5UZXh0O1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJbUmVzcG9uc2UgQW5pbWF0aW9uXSBmaW5pc2hlZFwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmVtYWluVGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBmZXRjaENvdW50ID0gTWF0aC5tYXgoMSwgTWF0aC5yb3VuZChyZW1haW5UZXh0Lmxlbmd0aCAvIDYwKSk7XG4gICAgICAgICAgICBjb25zdCBmZXRjaFRleHQgPSByZW1haW5UZXh0LnNsaWNlKDAsIGZldGNoQ291bnQpO1xuICAgICAgICAgICAgcmVzcG9uc2VUZXh0ICs9IGZldGNoVGV4dDtcbiAgICAgICAgICAgIHJlbWFpblRleHQgPSByZW1haW5UZXh0LnNsaWNlKGZldGNoQ291bnQpO1xuICAgICAgICAgICAgb3B0aW9ucy5vblVwZGF0ZT8uKHJlc3BvbnNlVGV4dCwgZmV0Y2hUZXh0KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZVJlc3BvbnNlVGV4dCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzdGFydCBhbmltYWlvblxuICAgICAgICBhbmltYXRlUmVzcG9uc2VUZXh0KCk7XG5cbiAgICAgICAgY29uc3QgZmluaXNoID0gKCkgPT4ge1xuICAgICAgICAgIGlmICghZmluaXNoZWQpIHtcbiAgICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIG9wdGlvbnMub25GaW5pc2gocmVzcG9uc2VUZXh0ICsgcmVtYWluVGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnRyb2xsZXIuc2lnbmFsLm9uYWJvcnQgPSBmaW5pc2g7XG5cbiAgICAgICAgZmV0Y2hFdmVudFNvdXJjZShjaGF0UGF0aCwge1xuICAgICAgICAgIC4uLmNoYXRQYXlsb2FkLFxuICAgICAgICAgIGFzeW5jIG9ub3BlbihyZXMpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChyZXF1ZXN0VGltZW91dElkKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gcmVzLmhlYWRlcnMuZ2V0KFwiY29udGVudC10eXBlXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgIFwiW09wZW5BSV0gcmVxdWVzdCByZXNwb25zZSBjb250ZW50IHR5cGU6IFwiLFxuICAgICAgICAgICAgICBjb250ZW50VHlwZSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChjb250ZW50VHlwZT8uc3RhcnRzV2l0aChcInRleHQvcGxhaW5cIikpIHtcbiAgICAgICAgICAgICAgcmVzcG9uc2VUZXh0ID0gYXdhaXQgcmVzLmNsb25lKCkudGV4dCgpO1xuICAgICAgICAgICAgICByZXR1cm4gZmluaXNoKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgIXJlcy5vayB8fFxuICAgICAgICAgICAgICAhcmVzLmhlYWRlcnNcbiAgICAgICAgICAgICAgICAuZ2V0KFwiY29udGVudC10eXBlXCIpXG4gICAgICAgICAgICAgICAgPy5zdGFydHNXaXRoKEV2ZW50U3RyZWFtQ29udGVudFR5cGUpIHx8XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMgIT09IDIwMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dHMgPSBbcmVzcG9uc2VUZXh0XTtcbiAgICAgICAgICAgICAgbGV0IGV4dHJhSW5mbyA9IGF3YWl0IHJlcy5jbG9uZSgpLnRleHQoKTtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXNKc29uID0gYXdhaXQgcmVzLmNsb25lKCkuanNvbigpO1xuICAgICAgICAgICAgICAgIGV4dHJhSW5mbyA9IHByZXR0eU9iamVjdChyZXNKc29uKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCB7fVxuXG4gICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZVRleHRzLnB1c2goTG9jYWxlLkVycm9yLlVuYXV0aG9yaXplZCk7XG4gICAgICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IFwiLyMvYXV0aFwiO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGV4dHJhSW5mbykge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlVGV4dHMucHVzaChleHRyYUluZm8pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmVzcG9uc2VUZXh0ID0gcmVzcG9uc2VUZXh0cy5qb2luKFwiXFxuXFxuXCIpO1xuXG4gICAgICAgICAgICAgIHJldHVybiBmaW5pc2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG9ubWVzc2FnZShtc2cpIHtcbiAgICAgICAgICAgIGlmIChtc2cuZGF0YSA9PT0gXCJbRE9ORV1cIiB8fCBmaW5pc2hlZCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmluaXNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0ZXh0ID0gbXNnLmRhdGE7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZSh0ZXh0KSBhcyB7XG4gICAgICAgICAgICAgICAgY2hvaWNlczogQXJyYXk8e1xuICAgICAgICAgICAgICAgICAgZGVsdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9PjtcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBqc29uLmNob2ljZXNbMF0/LmRlbHRhPy5jb250ZW50O1xuICAgICAgICAgICAgICBpZiAoZGVsdGEpIHtcbiAgICAgICAgICAgICAgICByZW1haW5UZXh0ICs9IGRlbHRhO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbUmVxdWVzdF0gcGFyc2UgZXJyb3JcIiwgdGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbmNsb3NlKCkge1xuICAgICAgICAgICAgZmluaXNoKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbmVycm9yKGUpIHtcbiAgICAgICAgICAgIG9wdGlvbnMub25FcnJvcj8uKGUpO1xuICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wZW5XaGVuSGlkZGVuOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGNoYXRQYXRoLCBjaGF0UGF5bG9hZCk7XG4gICAgICAgIGNsZWFyVGltZW91dChyZXF1ZXN0VGltZW91dElkKTtcblxuICAgICAgICBjb25zdCByZXNKc29uID0gYXdhaXQgcmVzLmpzb24oKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRoaXMuZXh0cmFjdE1lc3NhZ2UocmVzSnNvbik7XG4gICAgICAgIG9wdGlvbnMub25GaW5pc2gobWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5sb2coXCJbUmVxdWVzdF0gZmFpbGVkIHRvIG1ha2UgYSBjaGF0IHJlcXVlc3RcIiwgZSk7XG4gICAgICBvcHRpb25zLm9uRXJyb3I/LihlIGFzIEVycm9yKTtcbiAgICB9XG4gIH1cbiAgYXN5bmMgdXNhZ2UoKSB7XG4gICAgY29uc3QgZm9ybWF0RGF0ZSA9IChkOiBEYXRlKSA9PlxuICAgICAgYCR7ZC5nZXRGdWxsWWVhcigpfS0keyhkLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKX0tJHtkXG4gICAgICAgIC5nZXREYXRlKClcbiAgICAgICAgLnRvU3RyaW5nKClcbiAgICAgICAgLnBhZFN0YXJ0KDIsIFwiMFwiKX1gO1xuICAgIGNvbnN0IE9ORV9EQVkgPSAxICogMjQgKiA2MCAqIDYwICogMTAwMDtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHN0YXJ0T2ZNb250aCA9IG5ldyBEYXRlKG5vdy5nZXRGdWxsWWVhcigpLCBub3cuZ2V0TW9udGgoKSwgMSk7XG4gICAgY29uc3Qgc3RhcnREYXRlID0gZm9ybWF0RGF0ZShzdGFydE9mTW9udGgpO1xuICAgIGNvbnN0IGVuZERhdGUgPSBmb3JtYXREYXRlKG5ldyBEYXRlKERhdGUubm93KCkgKyBPTkVfREFZKSk7XG5cbiAgICBjb25zdCBbdXNlZCwgc3Vic10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBmZXRjaChcbiAgICAgICAgdGhpcy5wYXRoKFxuICAgICAgICAgIGAke09wZW5haVBhdGguVXNhZ2VQYXRofT9zdGFydF9kYXRlPSR7c3RhcnREYXRlfSZlbmRfZGF0ZT0ke2VuZERhdGV9YCxcbiAgICAgICAgKSxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBoZWFkZXJzOiBnZXRIZWFkZXJzKCksXG4gICAgICAgIH0sXG4gICAgICApLFxuICAgICAgZmV0Y2godGhpcy5wYXRoKE9wZW5haVBhdGguU3Vic1BhdGgpLCB7XG4gICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgaGVhZGVyczogZ2V0SGVhZGVycygpLFxuICAgICAgfSksXG4gICAgXSk7XG5cbiAgICBpZiAodXNlZC5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKExvY2FsZS5FcnJvci5VbmF1dGhvcml6ZWQpO1xuICAgIH1cblxuICAgIGlmICghdXNlZC5vayB8fCAhc3Vicy5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIHF1ZXJ5IHVzYWdlIGZyb20gb3BlbmFpXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3BvbnNlID0gKGF3YWl0IHVzZWQuanNvbigpKSBhcyB7XG4gICAgICB0b3RhbF91c2FnZT86IG51bWJlcjtcbiAgICAgIGVycm9yPzoge1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICAgIH07XG4gICAgfTtcblxuICAgIGNvbnN0IHRvdGFsID0gKGF3YWl0IHN1YnMuanNvbigpKSBhcyB7XG4gICAgICBoYXJkX2xpbWl0X3VzZD86IG51bWJlcjtcbiAgICB9O1xuXG4gICAgaWYgKHJlc3BvbnNlLmVycm9yICYmIHJlc3BvbnNlLmVycm9yLnR5cGUpIHtcbiAgICAgIHRocm93IEVycm9yKHJlc3BvbnNlLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGlmIChyZXNwb25zZS50b3RhbF91c2FnZSkge1xuICAgICAgcmVzcG9uc2UudG90YWxfdXNhZ2UgPSBNYXRoLnJvdW5kKHJlc3BvbnNlLnRvdGFsX3VzYWdlKSAvIDEwMDtcbiAgICB9XG5cbiAgICBpZiAodG90YWwuaGFyZF9saW1pdF91c2QpIHtcbiAgICAgIHRvdGFsLmhhcmRfbGltaXRfdXNkID0gTWF0aC5yb3VuZCh0b3RhbC5oYXJkX2xpbWl0X3VzZCAqIDEwMCkgLyAxMDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZWQ6IHJlc3BvbnNlLnRvdGFsX3VzYWdlLFxuICAgICAgdG90YWw6IHRvdGFsLmhhcmRfbGltaXRfdXNkLFxuICAgIH0gYXMgTExNVXNhZ2U7XG4gIH1cblxuICBhc3luYyBtb2RlbHMoKTogUHJvbWlzZTxMTE1Nb2RlbFtdPiB7XG4gICAgaWYgKHRoaXMuZGlzYWJsZUxpc3RNb2RlbHMpIHtcbiAgICAgIHJldHVybiBERUZBVUxUX01PREVMUy5zbGljZSgpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHRoaXMucGF0aChPcGVuYWlQYXRoLkxpc3RNb2RlbFBhdGgpLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLmdldEhlYWRlcnMoKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCByZXNKc29uID0gKGF3YWl0IHJlcy5qc29uKCkpIGFzIE9wZW5BSUxpc3RNb2RlbFJlc3BvbnNlO1xuICAgIGNvbnN0IGNoYXRNb2RlbHMgPSByZXNKc29uLmRhdGE/LmZpbHRlcigobSkgPT4gbS5pZC5zdGFydHNXaXRoKFwiZ3B0LVwiKSk7XG4gICAgY29uc29sZS5sb2coXCJbTW9kZWxzXVwiLCBjaGF0TW9kZWxzKTtcblxuICAgIGlmICghY2hhdE1vZGVscykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHJldHVybiBjaGF0TW9kZWxzLm1hcCgobSkgPT4gKHtcbiAgICAgIG5hbWU6IG0uaWQsXG4gICAgICBhdmFpbGFibGU6IHRydWUsXG4gICAgICBwcm92aWRlcjoge1xuICAgICAgICBpZDogXCJvcGVuYWlcIixcbiAgICAgICAgcHJvdmlkZXJOYW1lOiBcIk9wZW5BSVwiLFxuICAgICAgICBwcm92aWRlclR5cGU6IFwib3BlbmFpXCIsXG4gICAgICB9LFxuICAgIH0pKTtcbiAgfVxufVxuZXhwb3J0IHsgT3BlbmFpUGF0aCB9O1xuIl0sIm5hbWVzIjpbIkFwaVBhdGgiLCJERUZBVUxUX0FQSV9IT1NUIiwiREVGQVVMVF9NT0RFTFMiLCJPcGVuYWlQYXRoIiwiUkVRVUVTVF9USU1FT1VUX01TIiwiU2VydmljZVByb3ZpZGVyIiwidXNlQWNjZXNzU3RvcmUiLCJ1c2VBcHBDb25maWciLCJ1c2VDaGF0U3RvcmUiLCJnZXRIZWFkZXJzIiwiTG9jYWxlIiwiRXZlbnRTdHJlYW1Db250ZW50VHlwZSIsImZldGNoRXZlbnRTb3VyY2UiLCJwcmV0dHlPYmplY3QiLCJnZXRDbGllbnRDb25maWciLCJtYWtlQXp1cmVQYXRoIiwiQ2hhdEdQVEFwaSIsInBhdGgiLCJhY2Nlc3NTdG9yZSIsImdldFN0YXRlIiwiaXNBenVyZSIsInByb3ZpZGVyIiwiQXp1cmUiLCJpc1ZhbGlkQXp1cmUiLCJFcnJvciIsImJhc2VVcmwiLCJhenVyZVVybCIsIm9wZW5haVVybCIsImxlbmd0aCIsImlzQXBwIiwiT3BlbkFJIiwiZW5kc1dpdGgiLCJzbGljZSIsInN0YXJ0c1dpdGgiLCJhenVyZUFwaVZlcnNpb24iLCJjb25zb2xlIiwibG9nIiwiam9pbiIsImV4dHJhY3RNZXNzYWdlIiwicmVzIiwiY2hvaWNlcyIsImF0IiwibWVzc2FnZSIsImNvbnRlbnQiLCJjaGF0Iiwib3B0aW9ucyIsIm1lc3NhZ2VzIiwibWFwIiwidiIsInJvbGUiLCJtb2RlbENvbmZpZyIsImN1cnJlbnRTZXNzaW9uIiwibWFzayIsIm1vZGVsIiwiY29uZmlnIiwicmVxdWVzdFBheWxvYWQiLCJzdHJlYW0iLCJ0ZW1wZXJhdHVyZSIsInByZXNlbmNlX3BlbmFsdHkiLCJmcmVxdWVuY3lfcGVuYWx0eSIsInRvcF9wIiwic2hvdWxkU3RyZWFtIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsIm9uQ29udHJvbGxlciIsImNoYXRQYXRoIiwiQ2hhdFBhdGgiLCJjaGF0UGF5bG9hZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2lnbmFsIiwiaGVhZGVycyIsInJlcXVlc3RUaW1lb3V0SWQiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJyZXNwb25zZVRleHQiLCJyZW1haW5UZXh0IiwiZmluaXNoZWQiLCJhbmltYXRlUmVzcG9uc2VUZXh0IiwiYWJvcnRlZCIsImZldGNoQ291bnQiLCJNYXRoIiwibWF4Iiwicm91bmQiLCJmZXRjaFRleHQiLCJvblVwZGF0ZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImZpbmlzaCIsIm9uRmluaXNoIiwib25hYm9ydCIsIm9ub3BlbiIsImNvbnRlbnRUeXBlIiwiY2xlYXJUaW1lb3V0IiwiZ2V0IiwiY2xvbmUiLCJ0ZXh0Iiwib2siLCJzdGF0dXMiLCJyZXNwb25zZVRleHRzIiwiZXh0cmFJbmZvIiwicmVzSnNvbiIsImpzb24iLCJwdXNoIiwiVW5hdXRob3JpemVkIiwibG9jYXRpb24iLCJocmVmIiwib25tZXNzYWdlIiwibXNnIiwiZGF0YSIsInBhcnNlIiwiZGVsdGEiLCJlIiwiZXJyb3IiLCJvbmNsb3NlIiwib25lcnJvciIsIm9uRXJyb3IiLCJvcGVuV2hlbkhpZGRlbiIsImZldGNoIiwidXNhZ2UiLCJmb3JtYXREYXRlIiwiZCIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwiZ2V0RGF0ZSIsIk9ORV9EQVkiLCJub3ciLCJEYXRlIiwic3RhcnRPZk1vbnRoIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsInVzZWQiLCJzdWJzIiwiUHJvbWlzZSIsImFsbCIsIlVzYWdlUGF0aCIsIlN1YnNQYXRoIiwicmVzcG9uc2UiLCJ0b3RhbCIsInR5cGUiLCJ0b3RhbF91c2FnZSIsImhhcmRfbGltaXRfdXNkIiwibW9kZWxzIiwiZGlzYWJsZUxpc3RNb2RlbHMiLCJMaXN0TW9kZWxQYXRoIiwiY2hhdE1vZGVscyIsImZpbHRlciIsIm0iLCJpZCIsIm5hbWUiLCJhdmFpbGFibGUiLCJwcm92aWRlck5hbWUiLCJwcm92aWRlclR5cGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-client)/./app/client/platforms/openai.ts\n"));

/***/ })

});